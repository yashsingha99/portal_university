{"version":3,"file":"useLicenseLimitNotification-k-rSb5i-.js","sources":["../../ee/admin/src/hooks/useLicenseLimitNotification.ts"],"sourcesContent":["/**\n *\n * useLicenseLimitNotification\n *\n */\nimport * as React from 'react';\n\nimport { NotificationConfig, useNotification } from '@strapi/helper-plugin';\nimport isNil from 'lodash/isNil';\nimport { useIntl } from 'react-intl';\nimport { useLocation } from 'react-router-dom';\n\nimport { useLicenseLimits } from './useLicenseLimits';\n\nconst STORAGE_KEY_PREFIX = 'strapi-notification-seat-limit';\n\nconst BILLING_STRAPI_CLOUD_URL = 'https://cloud.strapi.io/profile/billing';\nconst BILLING_SELF_HOSTED_URL = 'https://strapi.io/billing/request-seats';\n\nexport const useLicenseLimitNotification = () => {\n  const { formatMessage } = useIntl();\n  const { license, isError, isLoading } = useLicenseLimits();\n  const toggleNotification = useNotification();\n  const { pathname } = useLocation();\n\n  const { enforcementUserCount, permittedSeats, licenseLimitStatus, isHostedOnStrapiCloud } =\n    license ?? {};\n\n  React.useEffect(() => {\n    if (isError || isLoading) {\n      return;\n    }\n\n    const shouldDisplayNotification =\n      !isNil(permittedSeats) &&\n      !window.sessionStorage.getItem(`${STORAGE_KEY_PREFIX}-${pathname}`) &&\n      (licenseLimitStatus === 'AT_LIMIT' || licenseLimitStatus === 'OVER_LIMIT');\n\n    let notificationType: NotificationConfig['type'];\n\n    if (licenseLimitStatus === 'OVER_LIMIT') {\n      notificationType = 'warning';\n    } else if (licenseLimitStatus === 'AT_LIMIT') {\n      notificationType = 'softWarning';\n    }\n\n    if (shouldDisplayNotification) {\n      toggleNotification({\n        type: notificationType,\n        message: formatMessage(\n          {\n            id: 'notification.ee.warning.over-.message',\n            defaultMessage:\n              \"Add seats to {licenseLimitStatus, select, OVER_LIMIT {invite} other {re-enable}} Users. If you already did it but it's not reflected in Strapi yet, make sure to restart your app.\",\n          },\n          { licenseLimitStatus }\n        ),\n        title: formatMessage(\n          {\n            id: 'notification.ee.warning.at-seat-limit.title',\n            defaultMessage:\n              '{licenseLimitStatus, select, OVER_LIMIT {Over} other {At}} seat limit ({enforcementUserCount}/{permittedSeats})',\n          },\n          {\n            licenseLimitStatus,\n            enforcementUserCount,\n            permittedSeats,\n          }\n        ),\n        link: {\n          url: isHostedOnStrapiCloud ? BILLING_STRAPI_CLOUD_URL : BILLING_SELF_HOSTED_URL,\n          label: formatMessage(\n            {\n              id: 'notification.ee.warning.seat-limit.link',\n              defaultMessage:\n                '{isHostedOnStrapiCloud, select, true {ADD SEATS} other {CONTACT SALES}}',\n            },\n            { isHostedOnStrapiCloud }\n          ),\n        },\n        blockTransition: true,\n        onClose() {\n          window.sessionStorage.setItem(`${STORAGE_KEY_PREFIX}-${pathname}`, 'true');\n        },\n      });\n    }\n  }, [\n    toggleNotification,\n    license,\n    pathname,\n    formatMessage,\n    isLoading,\n    permittedSeats,\n    licenseLimitStatus,\n    enforcementUserCount,\n    isHostedOnStrapiCloud,\n    isError,\n  ]);\n};\n"],"names":["useIntl","useLicenseLimits","useNotification","useLocation","React","isNil"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAcA,MAAM,qBAAqB;AAE3B,MAAM,2BAA2B;AACjC,MAAM,0BAA0B;AAEzB,MAAM,8BAA8B,MAAM;AACzC,QAAA,EAAE,kBAAkBA,UAAAA;AAC1B,QAAM,EAAE,SAAS,SAAS,cAAcC,MAAiB,iBAAA;AACzD,QAAM,qBAAqBC,aAAAA;AACrB,QAAA,EAAE,aAAaC,eAAAA;AAErB,QAAM,EAAE,sBAAsB,gBAAgB,oBAAoB,sBAAsB,IACtF,WAAW;AAEbC,mBAAM,UAAU,MAAM;AACpB,QAAI,WAAW,WAAW;AACxB;AAAA,IACF;AAEA,UAAM,4BACJ,CAACC,uBAAM,cAAc,KACrB,CAAC,OAAO,eAAe,QAAQ,GAAG,kBAAkB,IAAI,QAAQ,EAAE,MACjE,uBAAuB,cAAc,uBAAuB;AAE3D,QAAA;AAEJ,QAAI,uBAAuB,cAAc;AACpB,yBAAA;AAAA,IAAA,WACV,uBAAuB,YAAY;AACzB,yBAAA;AAAA,IACrB;AAEA,QAAI,2BAA2B;AACV,yBAAA;AAAA,QACjB,MAAM;AAAA,QACN,SAAS;AAAA,UACP;AAAA,YACE,IAAI;AAAA,YACJ,gBACE;AAAA,UACJ;AAAA,UACA,EAAE,mBAAmB;AAAA,QACvB;AAAA,QACA,OAAO;AAAA,UACL;AAAA,YACE,IAAI;AAAA,YACJ,gBACE;AAAA,UACJ;AAAA,UACA;AAAA,YACE;AAAA,YACA;AAAA,YACA;AAAA,UACF;AAAA,QACF;AAAA,QACA,MAAM;AAAA,UACJ,KAAK,wBAAwB,2BAA2B;AAAA,UACxD,OAAO;AAAA,YACL;AAAA,cACE,IAAI;AAAA,cACJ,gBACE;AAAA,YACJ;AAAA,YACA,EAAE,sBAAsB;AAAA,UAC1B;AAAA,QACF;AAAA,QACA,iBAAiB;AAAA,QACjB,UAAU;AACR,iBAAO,eAAe,QAAQ,GAAG,kBAAkB,IAAI,QAAQ,IAAI,MAAM;AAAA,QAC3E;AAAA,MAAA,CACD;AAAA,IACH;AAAA,EAAA,GACC;AAAA,IACD;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AACH;;"}