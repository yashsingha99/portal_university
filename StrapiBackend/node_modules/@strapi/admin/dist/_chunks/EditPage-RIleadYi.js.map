{"version":3,"file":"EditPage-RIleadYi.js","sources":["../../ee/admin/src/pages/SettingsPage/pages/ReviewWorkflows/EditPage.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport { Button, Flex, Loader, Typography } from '@strapi/design-system';\nimport { ConfirmDialog, useAPIErrorHandler, useNotification, useRBAC } from '@strapi/helper-plugin';\nimport { Check } from '@strapi/icons';\nimport { useFormik, Form, FormikProvider, FormikErrors } from 'formik';\nimport { useIntl } from 'react-intl';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useParams } from 'react-router-dom';\n\nimport { useAdminRoles } from '../../../../../../../admin/src/hooks/useAdminRoles';\nimport { useContentTypes } from '../../../../../../../admin/src/hooks/useContentTypes';\nimport { useInjectReducer } from '../../../../../../../admin/src/hooks/useInjectReducer';\nimport { selectAdminPermissions } from '../../../../../../../admin/src/selectors';\nimport { isBaseQueryError } from '../../../../../../../admin/src/utils/baseQuery';\nimport { Stage } from '../../../../../../../shared/contracts/review-workflows';\nimport { useLicenseLimits } from '../../../../hooks/useLicenseLimits';\nimport { useUpdateWorkflowMutation } from '../../../../services/reviewWorkflows';\n\nimport {\n  resetWorkflow,\n  setIsLoading,\n  setWorkflow,\n  setContentTypes,\n  setRoles,\n  setWorkflows,\n} from './actions';\nimport * as Layout from './components/Layout';\nimport { LimitsModal } from './components/LimitsModal';\nimport { Stages } from './components/Stages';\nimport { WorkflowAttributes } from './components/WorkflowAttributes';\nimport {\n  CHARGEBEE_WORKFLOW_ENTITLEMENT_NAME,\n  CHARGEBEE_STAGES_PER_WORKFLOW_ENTITLEMENT_NAME,\n  REDUX_NAMESPACE,\n} from './constants';\nimport { useReviewWorkflows } from './hooks/useReviewWorkflows';\nimport { CurrentWorkflow, reducer } from './reducer';\nimport {\n  selectIsWorkflowDirty,\n  selectCurrentWorkflow,\n  selectHasDeletedServerStages,\n  selectIsLoading,\n  selectRoles,\n  selectServerState,\n} from './selectors';\nimport { validateWorkflow } from './utils/validateWorkflow';\n\nexport const ReviewWorkflowsEditPage = () => {\n  const { workflowId } = useParams<{ workflowId: string }>();\n  const permissions = useSelector(selectAdminPermissions);\n  const { formatMessage } = useIntl();\n  const dispatch = useDispatch();\n  const {\n    _unstableFormatAPIError: formatAPIError,\n    _unstableFormatValidationErrors: formatValidationErrors,\n  } = useAPIErrorHandler();\n  const toggleNotification = useNotification();\n  const { isLoading: isLoadingWorkflow, meta, workflows } = useReviewWorkflows();\n  const { collectionTypes, singleTypes, isLoading: isLoadingContentTypes } = useContentTypes();\n  const serverState = useSelector(selectServerState);\n  const currentWorkflowIsDirty = useSelector(selectIsWorkflowDirty);\n  const currentWorkflow = useSelector(selectCurrentWorkflow);\n  const hasDeletedServerStages = useSelector(selectHasDeletedServerStages);\n  const roles = useSelector(selectRoles);\n  const isLoading = useSelector(selectIsLoading);\n  const {\n    allowedActions: { canDelete, canUpdate },\n  } = useRBAC(permissions.settings?.['review-workflows']);\n  const [savePrompts, setSavePrompts] = React.useState<{\n    hasDeletedServerStages?: boolean;\n    hasReassignedContentTypes?: boolean;\n  }>({});\n  const { getFeature, isLoading: isLicenseLoading } = useLicenseLimits();\n  const { isLoading: isLoadingRoles, roles: serverRoles } = useAdminRoles(undefined);\n  const [showLimitModal, setShowLimitModal] = React.useState<'workflow' | 'stage' | null>(null);\n  const [initialErrors, setInitialErrors] = React.useState<FormikErrors<CurrentWorkflow>>();\n  const [saving, setSaving] = React.useState(false);\n\n  const workflow = workflows?.find((workflow) => workflow.id === parseInt(workflowId, 10));\n  const contentTypesFromOtherWorkflows = workflows\n    ?.filter((workflow) => workflow.id !== parseInt(workflowId, 10))\n    .flatMap((workflow) => workflow.contentTypes);\n\n  const limits = getFeature<string>('review-workflows');\n  const numberOfWorkflows = limits?.[CHARGEBEE_WORKFLOW_ENTITLEMENT_NAME];\n  const stagesPerWorkflow = limits?.[CHARGEBEE_STAGES_PER_WORKFLOW_ENTITLEMENT_NAME];\n\n  const [updateWorkflow] = useUpdateWorkflowMutation();\n\n  const submitForm = async () => {\n    // reset the error messages\n    setInitialErrors(undefined);\n    setSaving(true);\n\n    try {\n      const res = await updateWorkflow({\n        id: workflowId!,\n        data: {\n          ...currentWorkflow,\n\n          // compare permissions of stages and only submit them if at least one has\n          // changed; this enables partial updates e.g. for users who don't have\n          // permissions to see roles\n          stages: currentWorkflow.stages?.map((stage) => {\n            let hasUpdatedPermissions = true;\n            const serverStage = serverState.workflow?.stages?.find(\n              (serverStage) => serverStage.id === stage?.id\n            );\n\n            if (serverStage) {\n              hasUpdatedPermissions =\n                serverStage.permissions?.length !== stage.permissions?.length ||\n                !serverStage.permissions?.every(\n                  (serverPermission) =>\n                    !!stage.permissions?.find(\n                      (permission) => permission.role === serverPermission.role\n                    )\n                );\n            }\n\n            return {\n              ...stage,\n              permissions: hasUpdatedPermissions ? stage.permissions : undefined,\n            } satisfies Stage;\n          }),\n        },\n      });\n\n      if ('error' in res) {\n        if (isBaseQueryError(res.error) && res.error.name === 'ValidationError') {\n          setInitialErrors(formatValidationErrors(res.error));\n        }\n\n        toggleNotification({\n          type: 'warning',\n          message: formatAPIError(res.error),\n        });\n\n        return;\n      }\n\n      toggleNotification({\n        type: 'success',\n        message: { id: 'notification.success.saved', defaultMessage: 'Saved' },\n      });\n    } catch (error) {\n      toggleNotification({\n        type: 'warning',\n        message: {\n          id: 'notification.error',\n          defaultMessage: 'An error occurred',\n        },\n      });\n    } finally {\n      setSaving(false);\n    }\n\n    setSavePrompts({});\n  };\n\n  const handleConfirmDeleteDialog = async () => {\n    await submitForm();\n  };\n\n  const handleConfirmClose = () => {\n    setSavePrompts({});\n  };\n\n  const formik = useFormik({\n    enableReinitialize: true,\n    initialErrors,\n    initialValues: currentWorkflow,\n    async onSubmit() {\n      const isContentTypeReassignment = currentWorkflow.contentTypes?.some((contentType) =>\n        contentTypesFromOtherWorkflows?.includes(contentType)\n      );\n\n      if (meta && numberOfWorkflows && meta?.workflowCount > parseInt(numberOfWorkflows, 10)) {\n        /**\n         * If the current license has a limit, check if the total count of workflows\n         * exceeds that limit and display the limits modal instead of sending the\n         * update, because it would throw an API error.\n         */\n        setShowLimitModal('workflow');\n\n        /**\n         * If the current license has a limit, check if the total count of stages\n         * exceeds that limit and display the limits modal instead of sending the\n         * update, because it would throw an API error.\n         */\n      } else if (\n        currentWorkflow.stages &&\n        stagesPerWorkflow &&\n        currentWorkflow.stages.length > parseInt(stagesPerWorkflow, 10)\n      ) {\n        setShowLimitModal('stage');\n      } else if (hasDeletedServerStages || isContentTypeReassignment) {\n        if (hasDeletedServerStages) {\n          setSavePrompts((prev) => ({ ...prev, hasDeletedServerStages: true }));\n        }\n\n        if (isContentTypeReassignment) {\n          setSavePrompts((prev) => ({ ...prev, hasReassignedContentTypes: true }));\n        }\n      } else {\n        submitForm();\n      }\n    },\n    validate(values) {\n      return validateWorkflow({ values, formatMessage });\n    },\n  });\n\n  useInjectReducer(REDUX_NAMESPACE, reducer);\n\n  React.useEffect(() => {\n    if (!isLoadingWorkflow && workflow && workflows) {\n      dispatch(setWorkflow({ workflow }));\n      dispatch(setWorkflows({ workflows }));\n    }\n\n    if (!isLoadingContentTypes) {\n      dispatch(setContentTypes({ collectionTypes, singleTypes }));\n    }\n\n    if (!isLoadingRoles) {\n      dispatch(setRoles(serverRoles));\n    }\n\n    dispatch(setIsLoading(isLoadingWorkflow || isLoadingContentTypes || isLoadingRoles));\n\n    // reset the state to the initial state to avoid flashes if a user\n    // navigates from an edit-view to a create-view\n    return () => {\n      dispatch(resetWorkflow());\n    };\n  }, [\n    collectionTypes,\n    dispatch,\n    isLoadingContentTypes,\n    isLoadingWorkflow,\n    isLoadingRoles,\n    serverRoles,\n    singleTypes,\n    workflow,\n    workflows,\n  ]);\n\n  /**\n   * If the current license has a limit:\n   * check if the total count of workflows or stages exceeds that limit and display\n   * the limits modal on page load. It can be closed by the user, but the\n   * API will throw an error in case they try to create a new workflow or update the\n   * stages.\n   *\n   * If the current license does not have a limit (e.g. offline license):\n   * do nothing (for now). In case they are trying to create the 201st workflow/ stage\n   * the API will throw an error.\n   *\n   */\n\n  React.useEffect(() => {\n    if (!isLoadingWorkflow && !isLicenseLoading) {\n      if (meta && numberOfWorkflows && meta?.workflowCount > parseInt(numberOfWorkflows, 10)) {\n        setShowLimitModal('workflow');\n      } else if (\n        currentWorkflow.stages &&\n        stagesPerWorkflow &&\n        currentWorkflow.stages.length > parseInt(stagesPerWorkflow, 10)\n      ) {\n        setShowLimitModal('stage');\n      }\n    }\n  }, [\n    currentWorkflow.stages,\n    isLicenseLoading,\n    isLoadingWorkflow,\n    limits,\n    meta,\n    numberOfWorkflows,\n    stagesPerWorkflow,\n  ]);\n\n  React.useEffect(() => {\n    if (!isLoading && roles?.length === 0) {\n      toggleNotification({\n        blockTransition: true,\n        type: 'warning',\n        message: formatMessage({\n          id: 'Settings.review-workflows.stage.permissions.noPermissions.description',\n          defaultMessage: 'You don’t have the permission to see roles',\n        }),\n      });\n    }\n  }, [formatMessage, isLoading, roles, toggleNotification]);\n\n  // TODO: redirect back to list-view if workflow is not found?\n\n  return (\n    <>\n      <Layout.DragLayerRendered />\n\n      <FormikProvider value={formik}>\n        <Form onSubmit={formik.handleSubmit}>\n          <Layout.Header\n            navigationAction={<Layout.Back href=\"/settings/review-workflows\" />}\n            primaryAction={\n              canUpdate && (\n                <Button\n                  startIcon={<Check />}\n                  type=\"submit\"\n                  size=\"M\"\n                  disabled={!currentWorkflowIsDirty}\n                  // if the confirm dialog is open the loading state is on\n                  // the confirm button already\n                  loading={!Boolean(Object.keys(savePrompts).length > 0) && saving}\n                >\n                  {formatMessage({\n                    id: 'global.save',\n                    defaultMessage: 'Save',\n                  })}\n                </Button>\n              )\n            }\n            subtitle={\n              !isLoading &&\n              formatMessage(\n                {\n                  id: 'Settings.review-workflows.page.subtitle',\n                  defaultMessage: '{count, plural, one {# stage} other {# stages}}',\n                },\n                { count: currentWorkflow.stages?.length }\n              )\n            }\n            title={currentWorkflow.name || ''}\n          />\n\n          <Layout.Root>\n            {isLoading ? (\n              <Flex justifyContent=\"center\">\n                <Loader>\n                  {formatMessage({\n                    id: 'Settings.review-workflows.page.isLoading',\n                    defaultMessage: 'Workflow is loading',\n                  })}\n                </Loader>\n              </Flex>\n            ) : (\n              <Flex alignItems=\"stretch\" direction=\"column\" gap={7}>\n                <WorkflowAttributes canUpdate={canUpdate} />\n                <Stages\n                  canDelete={canDelete}\n                  canUpdate={canUpdate}\n                  stages={formik.values?.stages}\n                />\n              </Flex>\n            )}\n          </Layout.Root>\n        </Form>\n      </FormikProvider>\n\n      <ConfirmDialog.Root\n        isConfirmButtonLoading={isLoading}\n        isOpen={Object.keys(savePrompts).length > 0}\n        onToggleDialog={handleConfirmClose}\n        onConfirm={handleConfirmDeleteDialog}\n      >\n        <ConfirmDialog.Body>\n          <Flex direction=\"column\" gap={5}>\n            {savePrompts.hasDeletedServerStages && (\n              <Typography textAlign=\"center\" variant=\"omega\">\n                {formatMessage({\n                  id: 'Settings.review-workflows.page.delete.confirm.stages.body',\n                  defaultMessage:\n                    'All entries assigned to deleted stages will be moved to the previous stage.',\n                })}\n              </Typography>\n            )}\n\n            {savePrompts.hasReassignedContentTypes && (\n              <Typography textAlign=\"center\" variant=\"omega\">\n                {formatMessage(\n                  {\n                    id: 'Settings.review-workflows.page.delete.confirm.contentType.body',\n                    defaultMessage:\n                      '{count} {count, plural, one {content-type} other {content-types}} {count, plural, one {is} other {are}} already mapped to {count, plural, one {another workflow} other {other workflows}}. If you save changes, {count, plural, one {this} other {these}} {count, plural, one {content-type} other {{count} content-types}} will no more be mapped to the {count, plural, one {another workflow} other {other workflows}} and all corresponding information will be removed.',\n                  },\n                  {\n                    count: contentTypesFromOtherWorkflows?.filter((contentType) =>\n                      currentWorkflow.contentTypes?.includes(contentType)\n                    ).length,\n                  }\n                )}\n              </Typography>\n            )}\n\n            <Typography textAlign=\"center\" variant=\"omega\">\n              {formatMessage({\n                id: 'Settings.review-workflows.page.delete.confirm.confirm',\n                defaultMessage: 'Are you sure you want to save?',\n              })}\n            </Typography>\n          </Flex>\n        </ConfirmDialog.Body>\n      </ConfirmDialog.Root>\n\n      <LimitsModal.Root\n        isOpen={showLimitModal === 'workflow'}\n        onClose={() => setShowLimitModal(null)}\n      >\n        <LimitsModal.Title>\n          {formatMessage({\n            id: 'Settings.review-workflows.edit.page.workflows.limit.title',\n            defaultMessage: 'You’ve reached the limit of workflows in your plan',\n          })}\n        </LimitsModal.Title>\n\n        <LimitsModal.Body>\n          {formatMessage({\n            id: 'Settings.review-workflows.edit.page.workflows.limit.body',\n            defaultMessage: 'Delete a workflow or contact Sales to enable more workflows.',\n          })}\n        </LimitsModal.Body>\n      </LimitsModal.Root>\n\n      <LimitsModal.Root isOpen={showLimitModal === 'stage'} onClose={() => setShowLimitModal(null)}>\n        <LimitsModal.Title>\n          {formatMessage({\n            id: 'Settings.review-workflows.edit.page.stages.limit.title',\n            defaultMessage: 'You have reached the limit of stages for this workflow in your plan',\n          })}\n        </LimitsModal.Title>\n\n        <LimitsModal.Body>\n          {formatMessage({\n            id: 'Settings.review-workflows.edit.page.stages.limit.body',\n            defaultMessage: 'Try deleting some stages or contact Sales to enable more stages.',\n          })}\n        </LimitsModal.Body>\n      </LimitsModal.Root>\n    </>\n  );\n};\n"],"names":["useParams","useSelector","selectAdminPermissions","useIntl","useDispatch","useAPIErrorHandler","useNotification","useReviewWorkflows","useContentTypes","selectServerState","selectIsWorkflowDirty","selectCurrentWorkflow","selectHasDeletedServerStages","selectRoles","selectIsLoading","useRBAC","React","useLicenseLimits","useAdminRoles","workflow","CHARGEBEE_WORKFLOW_ENTITLEMENT_NAME","CHARGEBEE_STAGES_PER_WORKFLOW_ENTITLEMENT_NAME","useUpdateWorkflowMutation","serverStage","isBaseQueryError","formik","useFormik","validateWorkflow","useInjectReducer","REDUX_NAMESPACE","reducer","setWorkflow","setWorkflows","setContentTypes","setRoles","setIsLoading","resetWorkflow","jsxs","Fragment","jsx","Layout.DragLayerRendered","FormikProvider","Form","Layout.Header","Layout.Back","Button","Check","Layout.Root","Flex","Loader","WorkflowAttributes","Stages","ConfirmDialog","Typography","LimitsModal"],"mappings":"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"}