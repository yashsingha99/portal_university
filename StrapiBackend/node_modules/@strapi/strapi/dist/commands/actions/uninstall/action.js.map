{"version":3,"file":"action.js","sources":["../../../../src/commands/actions/uninstall/action.ts"],"sourcesContent":["import { join } from 'path';\nimport { existsSync, removeSync } from 'fs-extra';\nimport ora from 'ora';\nimport execa from 'execa';\nimport inquirer from 'inquirer';\nimport findPackagePath from '../../../load/package-path';\n\ninterface CmdOptions {\n  deleteFiles?: boolean;\n}\n\nexport default async (plugins: string[], { deleteFiles }: CmdOptions) => {\n  const answers = await inquirer.prompt([\n    {\n      type: 'confirm',\n      name: 'deleteFiles',\n      message: `Do you want to delete the plugin generated files in the extensions folder ?`,\n      default: true,\n      when: !deleteFiles,\n    },\n  ]);\n\n  const loader = ora();\n  const dir = process.cwd();\n\n  const pluginArgs = plugins.map((name) => `@strapi/plugin-${name}`);\n\n  try {\n    // verify should rebuild before removing the pacakge\n    let shouldRebuild = false;\n    for (const name of plugins) {\n      const pkgPath = findPackagePath(`@strapi/plugin-${name}`);\n      if (existsSync(join(pkgPath, 'admin', 'src', 'index.js'))) {\n        shouldRebuild = true;\n      }\n    }\n\n    loader.start(`Uninstalling dependencies`);\n\n    const useYarn = existsSync(join(dir, 'yarn.lock'));\n    if (useYarn) {\n      await execa('yarn', ['remove', ...pluginArgs]);\n    } else {\n      await execa('npm', ['remove', ...pluginArgs]);\n    }\n\n    loader.succeed();\n\n    if (deleteFiles === true || answers.deleteFiles === true) {\n      loader.start('Deleting old files');\n      for (const name of plugins) {\n        const pluginDir = join(dir, 'extensions', name);\n        if (existsSync(pluginDir)) {\n          removeSync(pluginDir);\n        }\n      }\n      loader.succeed();\n    }\n\n    if (shouldRebuild) {\n      loader.start(`Rebuilding admin UI`);\n      await execa('npm', ['run', 'build']);\n      loader.succeed();\n    }\n  } catch (err) {\n    loader.clear();\n\n    if (err instanceof Error) {\n      console.error(err.message);\n    }\n\n    process.exit(1);\n  }\n};\n"],"names":["inquirer","ora","findPackagePath","existsSync","join","execa","removeSync"],"mappings":";;;;;;;;;;;AAWA,MAAA,SAAe,OAAO,SAAmB,EAAE,kBAA8B;AACjE,QAAA,UAAU,MAAMA,kBAAA,QAAS,OAAO;AAAA,IACpC;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,SAAS;AAAA,MACT,SAAS;AAAA,MACT,MAAM,CAAC;AAAA,IACT;AAAA,EAAA,CACD;AAED,QAAM,SAASC,aAAAA;AACT,QAAA,MAAM,QAAQ;AAEpB,QAAM,aAAa,QAAQ,IAAI,CAAC,SAAS,kBAAkB,IAAI,EAAE;AAE7D,MAAA;AAEF,QAAI,gBAAgB;AACpB,eAAW,QAAQ,SAAS;AAC1B,YAAM,UAAUC,YAAgB,kBAAkB,IAAI,EAAE;AACxD,UAAIC,IAAAA,WAAWC,KAAAA,KAAK,SAAS,SAAS,OAAO,UAAU,CAAC,GAAG;AACzC,wBAAA;AAAA,MAClB;AAAA,IACF;AAEA,WAAO,MAAM,2BAA2B;AAExC,UAAM,UAAUD,IAAAA,WAAWC,KAAAA,KAAK,KAAK,WAAW,CAAC;AACjD,QAAI,SAAS;AACX,YAAMC,eAAAA,QAAM,QAAQ,CAAC,UAAU,GAAG,UAAU,CAAC;AAAA,IAAA,OACxC;AACL,YAAMA,eAAAA,QAAM,OAAO,CAAC,UAAU,GAAG,UAAU,CAAC;AAAA,IAC9C;AAEA,WAAO,QAAQ;AAEf,QAAI,gBAAgB,QAAQ,QAAQ,gBAAgB,MAAM;AACxD,aAAO,MAAM,oBAAoB;AACjC,iBAAW,QAAQ,SAAS;AAC1B,cAAM,YAAYD,KAAA,KAAK,KAAK,cAAc,IAAI;AAC1C,YAAAD,IAAAA,WAAW,SAAS,GAAG;AACzBG,cAAA,WAAW,SAAS;AAAA,QACtB;AAAA,MACF;AACA,aAAO,QAAQ;AAAA,IACjB;AAEA,QAAI,eAAe;AACjB,aAAO,MAAM,qBAAqB;AAClC,YAAMD,eAAM,QAAA,OAAO,CAAC,OAAO,OAAO,CAAC;AACnC,aAAO,QAAQ;AAAA,IACjB;AAAA,WACO,KAAK;AACZ,WAAO,MAAM;AAEb,QAAI,eAAe,OAAO;AAChB,cAAA,MAAM,IAAI,OAAO;AAAA,IAC3B;AAEA,YAAQ,KAAK,CAAC;AAAA,EAChB;AACF;;"}