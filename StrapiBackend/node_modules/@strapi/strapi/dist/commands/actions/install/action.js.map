{"version":3,"file":"action.js","sources":["../../../../src/commands/actions/install/action.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-var-requires */\nimport { join } from 'path';\nimport { existsSync } from 'fs-extra';\nimport ora from 'ora';\nimport execa from 'execa';\nimport findPackagePath from '../../../load/package-path';\n\nexport default async (plugins: string[]) => {\n  const loader = ora();\n  const dir = process.cwd();\n\n  const version = require(join(dir, 'package.json')).dependencies['@strapi/strapi'];\n\n  const pluginArgs = plugins.map((name: string) => `@strapi/plugin-${name}@${version}`);\n\n  try {\n    loader.start(`Installing dependencies`);\n\n    const useYarn = existsSync(join(dir, 'yarn.lock'));\n    if (useYarn) {\n      await execa('yarn', ['add', ...pluginArgs]);\n    } else {\n      await execa('npm', ['install', '--save', ...pluginArgs]);\n    }\n\n    loader.succeed();\n\n    // check if rebuild is necessary\n    let shouldRebuild = false;\n    for (const name of plugins) {\n      const pkgPath = findPackagePath(`@strapi/plugin-${name}`);\n      if (existsSync(join(pkgPath, 'admin', 'src', 'index.js'))) {\n        shouldRebuild = true;\n      }\n    }\n\n    if (shouldRebuild) {\n      loader.start(`Rebuilding admin UI`);\n      await execa('npm', ['run', 'build']);\n      loader.succeed();\n    }\n  } catch (err) {\n    loader.clear();\n\n    if (err instanceof Error) {\n      console.error(err.message);\n    }\n\n    process.exit(1);\n  }\n};\n"],"names":["ora","join","existsSync","execa","findPackagePath"],"mappings":";;;;;;;;;AAOA,MAAe,SAAA,OAAO,YAAsB;AAC1C,QAAM,SAASA,aAAAA;AACT,QAAA,MAAM,QAAQ;AAEd,QAAA,UAAU,QAAQC,UAAK,KAAK,cAAc,CAAC,EAAE,aAAa,gBAAgB;AAE1E,QAAA,aAAa,QAAQ,IAAI,CAAC,SAAiB,kBAAkB,IAAI,IAAI,OAAO,EAAE;AAEhF,MAAA;AACF,WAAO,MAAM,yBAAyB;AAEtC,UAAM,UAAUC,IAAAA,WAAWD,KAAAA,KAAK,KAAK,WAAW,CAAC;AACjD,QAAI,SAAS;AACX,YAAME,eAAAA,QAAM,QAAQ,CAAC,OAAO,GAAG,UAAU,CAAC;AAAA,IAAA,OACrC;AACL,YAAMA,eAAAA,QAAM,OAAO,CAAC,WAAW,UAAU,GAAG,UAAU,CAAC;AAAA,IACzD;AAEA,WAAO,QAAQ;AAGf,QAAI,gBAAgB;AACpB,eAAW,QAAQ,SAAS;AAC1B,YAAM,UAAUC,YAAgB,kBAAkB,IAAI,EAAE;AACxD,UAAIF,IAAAA,WAAWD,KAAAA,KAAK,SAAS,SAAS,OAAO,UAAU,CAAC,GAAG;AACzC,wBAAA;AAAA,MAClB;AAAA,IACF;AAEA,QAAI,eAAe;AACjB,aAAO,MAAM,qBAAqB;AAClC,YAAME,eAAM,QAAA,OAAO,CAAC,OAAO,OAAO,CAAC;AACnC,aAAO,QAAQ;AAAA,IACjB;AAAA,WACO,KAAK;AACZ,WAAO,MAAM;AAEb,QAAI,eAAe,OAAO;AAChB,cAAA,MAAM,IAAI,OAAO;AAAA,IAC3B;AAEA,YAAQ,KAAK,CAAC;AAAA,EAChB;AACF;;"}