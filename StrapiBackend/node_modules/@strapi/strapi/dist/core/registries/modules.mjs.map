{"version":3,"file":"modules.mjs","sources":["../../../src/core/registries/modules.ts"],"sourcesContent":["import { pickBy, has } from 'lodash/fp';\nimport type { Strapi } from '@strapi/types';\nimport { createModule, RawModule, Module } from '../domain/module';\n\ntype ModuleMap = { [namespace: string]: Module };\n\nconst modulesRegistry = (strapi: Strapi) => {\n  const modules: ModuleMap = {};\n\n  return {\n    get(namespace: string) {\n      return modules[namespace];\n    },\n    getAll(prefix = '') {\n      return pickBy<ModuleMap>((mod, namespace) => namespace.startsWith(prefix))(modules);\n    },\n    add(namespace: string, rawModule: RawModule) {\n      if (has(namespace, modules)) {\n        throw new Error(`Module ${namespace} has already been registered.`);\n      }\n\n      modules[namespace] = createModule(namespace, rawModule, strapi);\n      modules[namespace].load();\n\n      return modules[namespace];\n    },\n    async bootstrap() {\n      for (const mod of Object.values(modules)) {\n        await mod.bootstrap();\n      }\n    },\n    async register() {\n      for (const mod of Object.values(modules)) {\n        await mod.register();\n      }\n    },\n    async destroy() {\n      for (const mod of Object.values(modules)) {\n        await mod.destroy();\n      }\n    },\n  };\n};\n\nexport default modulesRegistry;\n"],"names":[],"mappings":";;AAMM,MAAA,kBAAkB,CAAC,WAAmB;AAC1C,QAAM,UAAqB,CAAA;AAEpB,SAAA;AAAA,IACL,IAAI,WAAmB;AACrB,aAAO,QAAQ,SAAS;AAAA,IAC1B;AAAA,IACA,OAAO,SAAS,IAAI;AACX,aAAA,OAAkB,CAAC,KAAK,cAAc,UAAU,WAAW,MAAM,CAAC,EAAE,OAAO;AAAA,IACpF;AAAA,IACA,IAAI,WAAmB,WAAsB;AACvC,UAAA,IAAI,WAAW,OAAO,GAAG;AAC3B,cAAM,IAAI,MAAM,UAAU,SAAS,+BAA+B;AAAA,MACpE;AAEA,cAAQ,SAAS,IAAI,aAAa,WAAW,WAAW,MAAM;AACtD,cAAA,SAAS,EAAE;AAEnB,aAAO,QAAQ,SAAS;AAAA,IAC1B;AAAA,IACA,MAAM,YAAY;AAChB,iBAAW,OAAO,OAAO,OAAO,OAAO,GAAG;AACxC,cAAM,IAAI;MACZ;AAAA,IACF;AAAA,IACA,MAAM,WAAW;AACf,iBAAW,OAAO,OAAO,OAAO,OAAO,GAAG;AACxC,cAAM,IAAI;MACZ;AAAA,IACF;AAAA,IACA,MAAM,UAAU;AACd,iBAAW,OAAO,OAAO,OAAO,OAAO,GAAG;AACxC,cAAM,IAAI;MACZ;AAAA,IACF;AAAA,EAAA;AAEJ;"}