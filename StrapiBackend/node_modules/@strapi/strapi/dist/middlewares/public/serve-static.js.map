{"version":3,"file":"serve-static.js","sources":["../../../src/middlewares/public/serve-static.ts"],"sourcesContent":["import path from 'path';\nimport koaStatic from 'koa-static';\nimport type { Common } from '@strapi/types';\n\n// serveStatic is not supposed to be used to serve a folder that have sub-folders\nexport const serveStatic = (filesDir: string, koaStaticOptions: koaStatic.Options = {}) => {\n  const serve = koaStatic(filesDir, koaStaticOptions);\n\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  const middleware: Common.MiddlewareHandler = async (ctx, next) => {\n    const prev = ctx.path;\n    const newPath = path.basename(ctx.path);\n    ctx.path = newPath;\n\n    await serve(ctx, async () => {\n      ctx.path = prev;\n      await next();\n      ctx.path = newPath;\n    });\n    ctx.path = prev;\n  };\n\n  return middleware;\n};\n"],"names":["koaStatic","path"],"mappings":";;;;;;;AAKO,MAAM,cAAc,CAAC,UAAkB,mBAAsC,OAAO;AACnF,QAAA,QAAQA,mBAAAA,QAAU,UAAU,gBAAgB;AAG5C,QAAA,aAAuC,OAAO,KAAK,SAAS;AAChE,UAAM,OAAO,IAAI;AACjB,UAAM,UAAUC,cAAA,QAAK,SAAS,IAAI,IAAI;AACtC,QAAI,OAAO;AAEL,UAAA,MAAM,KAAK,YAAY;AAC3B,UAAI,OAAO;AACX,YAAM,KAAK;AACX,UAAI,OAAO;AAAA,IAAA,CACZ;AACD,QAAI,OAAO;AAAA,EAAA;AAGN,SAAA;AACT;;"}