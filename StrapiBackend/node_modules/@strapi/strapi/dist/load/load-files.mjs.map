{"version":3,"file":"load-files.mjs","sources":["../../src/load/load-files.ts"],"sourcesContent":["import path from 'path';\nimport _ from 'lodash';\nimport fse from 'fs-extra';\n\nimport { importDefault } from '@strapi/utils';\nimport glob from './glob';\nimport filePathToPath from './filepath-to-prop-path';\n\n/**\n * Returns an Object build from a list of files matching a glob pattern in a directory\n * It builds a tree structure resembling the folder structure in dir\n */\nexport default async function loadFiles<T extends object>(\n  dir: string,\n  pattern: string,\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  { requireFn = importDefault, shouldUseFileNameAsKey = (_: any) => true, globArgs = {} } = {}\n): Promise<T> {\n  const root = {};\n  const files = await glob(pattern, { cwd: dir, ...globArgs });\n\n  for (const file of files) {\n    const absolutePath = path.resolve(dir, file);\n\n    // load module\n    delete require.cache[absolutePath];\n    let mod;\n\n    if (path.extname(absolutePath) === '.json') {\n      mod = await fse.readJson(absolutePath);\n    } else {\n      mod = requireFn(absolutePath);\n    }\n\n    Object.defineProperty(mod, '__filename__', {\n      enumerable: true,\n      configurable: false,\n      writable: false,\n      value: path.basename(file),\n    });\n\n    const propPath = filePathToPath(file, shouldUseFileNameAsKey(file));\n\n    if (propPath.length === 0) _.merge(root, mod);\n    _.merge(root, _.setWith({}, propPath, mod, Object));\n  }\n\n  return root as T;\n}\n"],"names":["_","glob"],"mappings":";;;;;;AAYA,eAA8B,UAC5B,KACA,SAEA,EAAE,YAAY,eAAe,yBAAyB,CAACA,OAAW,MAAM,WAAW,CAAG,EAAA,IAAI,CAAA,GAC9E;AACZ,QAAM,OAAO,CAAA;AACP,QAAA,QAAQ,MAAMC,YAAK,SAAS,EAAE,KAAK,KAAK,GAAG,SAAA,CAAU;AAE3D,aAAW,QAAQ,OAAO;AACxB,UAAM,eAAe,KAAK,QAAQ,KAAK,IAAI;AAGpC,WAAA,QAAQ,MAAM,YAAY;AAC7B,QAAA;AAEJ,QAAI,KAAK,QAAQ,YAAY,MAAM,SAAS;AACpC,YAAA,MAAM,IAAI,SAAS,YAAY;AAAA,IAAA,OAChC;AACL,YAAM,UAAU,YAAY;AAAA,IAC9B;AAEO,WAAA,eAAe,KAAK,gBAAgB;AAAA,MACzC,YAAY;AAAA,MACZ,cAAc;AAAA,MACd,UAAU;AAAA,MACV,OAAO,KAAK,SAAS,IAAI;AAAA,IAAA,CAC1B;AAED,UAAM,WAAW,eAAe,MAAM,uBAAuB,IAAI,CAAC;AAElE,QAAI,SAAS,WAAW;AAAK,QAAA,MAAM,MAAM,GAAG;AAC1C,MAAA,MAAM,MAAM,EAAE,QAAQ,CAAI,GAAA,UAAU,KAAK,MAAM,CAAC;AAAA,EACpD;AAEO,SAAA;AACT;"}